---
layout: default
title: "Media"
permalink: /media/
classes: media-page
hide_captions: false
---

<style>
  /* Maximum specificity - target the exact page structure */
  body .page__inner-wrap .media-page .media-card,
  body .media-page .media-card,
  .media-card {
    min-width: 0 !important;
    background: #fff !important;
    border: 1px solid #e1e4e8 !important;
    border-radius: 8px !important;
    padding: 1rem !important;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
    margin: 0 !important;
    display: block !important;
    width: 100% !important;
    box-sizing: border-box !important;
    transition: box-shadow 0.2s ease !important;
  }
  
  /* Hover effect for cards */
  .media-card:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15) !important;
    border-color: #d1d5da !important;
  }
  
  /* Grid container with tighter spacing */
  body .media-page .media-grid,
  .media-grid {
    display: grid !important;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)) !important;
    grid-auto-rows: 10px !important;
    gap: 12px !important;
    align-items: start !important;
    width: 100% !important;
    max-width: none !important;
    padding: 0 !important;
    margin: 20px 0 !important;
  }
  
  /* Ensure full width for default layout */
  body .media-page {
    max-width: none !important;
    width: 100% !important;
    padding: 0 20px !important;
  }
  
  /* Spacing with higher specificity */
  .media-page .media-card h3,
  body .media-card h3 { 
    margin: 0 0 0.25rem !important; 
    font-size: 1rem !important;
    color: #333 !important;
  }
  
  .media-page .publication-meta,
  body .media-card .publication-meta { 
    margin: 0 0 0.5rem !important; 
    color: #666 !important; 
    font-size: 0.9rem !important;
  }
  
  .media-page .media-summary,
  body .media-card .media-summary { 
    margin-top: 0.5rem !important;
    font-size: 0.9rem !important;
  }
  
  /* Teaser image styling */
  .media-page .media-card .teaser-image,
  body .media-card .teaser-image {
    width: 100% !important;
    height: auto !important;
    border-radius: 4px !important;
    margin-bottom: 0.5rem !important;
  }

  /* Production debugging - remove after fixing */
  .debug-info {
    position: fixed;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.8);
    color: white;
    padding: 10px;
    font-size: 12px;
    z-index: 9999;
    max-width: 300px;
  }
</style>

<h1>Media</h1>

<!-- Debug info for production -->
<div class="debug-info" id="debug-info">
  Initializing...
</div>

<section class="media-grid">
  {% assign media_items = site.media | sort: "date" | reverse %}
  {% for item in media_items %}
    <article class="media-card">
      
      {% if item.date %}
        <p class="publication-meta">
          <time datetime="{{ item.date | date_to_xmlschema }}">{{ item.date | date: "%B %Y" }}</time>
        </p>
      {% endif %}

      <h3 class="archive__item-title">
        {% if item.link %}<a href="{{ item.link }}">{{ item.title }}</a>{% else %}{{ item.title }}{% endif %}
      </h3>

      {% if item.summary or item.excerpt %}
        <div class="media-summary">{{ item.summary | default: item.excerpt | markdownify }}</div>
      {% endif %}

      {% if item.header.teaser %}
        <img src="{{ site.baseurl }}/images/{{ item.header.teaser }}" alt="{{ item.title }}" class="teaser-image">
      {% endif %}

      <div class="media-embed">
        {% if page.hide_captions %}
          {{ item.content | replace: 'data-instgrm-captioned', '' }}
        {% else %}
          {{ item.content }}
        {% endif %}
      </div>
    </article>
  {% endfor %}
</section>

<script async src="https://www.instagram.com/embed.js"></script>
<script>
let masonryAttempts = 0;
let lastHeights = [];

function updateDebug(message) {
  const debug = document.getElementById('debug-info');
  if (debug) {
    debug.innerHTML = `Attempt ${masonryAttempts}: ${message}<br>Time: ${new Date().toLocaleTimeString()}`;
  }
}

function masonryLayout() {
  const grid = document.querySelector('.media-grid');
  if (!grid) {
    updateDebug('Grid not found');
    return;
  }
  
  const items = grid.querySelectorAll('.media-card');
  const rowHeight = 10;
  const gap = 12;
  
  masonryAttempts++;
  
  // Reset all items
  items.forEach(item => {
    item.style.gridRowEnd = 'auto';
  });
  
  // Force reflow
  grid.offsetHeight;
  
  // Wait a bit for content to settle, then calculate
  setTimeout(() => {
    const currentHeights = [];
    
    items.forEach((item, index) => {
      const rect = item.getBoundingClientRect();
      const itemHeight = rect.height;
      currentHeights.push(itemHeight);
      
      const rowSpan = Math.ceil((itemHeight + gap) / (rowHeight + gap));
      item.style.gridRowEnd = `span ${Math.max(1, rowSpan)}`;
    });
    
    // Check if heights are still changing (content still loading)
    const heightsChanged = JSON.stringify(currentHeights) !== JSON.stringify(lastHeights);
    lastHeights = currentHeights.slice();
    
    updateDebug(`Heights changed: ${heightsChanged}, Max height: ${Math.max(...currentHeights)}px`);
    
    // If heights are still changing and we haven't tried too many times, try again
    if (heightsChanged && masonryAttempts < 20) {
      setTimeout(masonryLayout, 1000);
    }
  }, 100);
}

// More aggressive initialization for production
function initMasonry() {
  updateDebug('Starting masonry initialization');
  
  // Run immediately
  masonryLayout();
  
  // Then run at multiple intervals to catch late-loading content
  const delays = [100, 300, 500, 1000, 2000, 3000, 5000, 8000, 12000];
  
  delays.forEach(delay => {
    setTimeout(() => {
      masonryLayout();
    }, delay);
  });
}

// Multiple event listeners to catch different loading states
document.addEventListener('DOMContentLoaded', () => {
  updateDebug('DOM loaded');
  initMasonry();
});

window.addEventListener('load', () => {
  updateDebug('Window loaded');
  setTimeout(initMasonry, 200);
});

// Instagram embed handling
function handleInstagramEmbeds() {
  if (window.instgrm && window.instgrm.Embeds) {
    updateDebug('Processing Instagram embeds');
    window.instgrm.Embeds.process();
    setTimeout(masonryLayout, 1500); // Give embeds time to render
  }
}

// Try to process Instagram embeds multiple times
setTimeout(handleInstagramEmbeds, 1000);
setTimeout(handleInstagramEmbeds, 3000);
setTimeout(handleInstagramEmbeds, 6000);

// Handle window resize
window.addEventListener('resize', function() {
  clearTimeout(window.resizeTimer);
  window.resizeTimer = setTimeout(() => {
    updateDebug('Window resized');
    masonryLayout();
  }, 300);
});

// Keep checking for new content periodically
setInterval(() => {
  if (masonryAttempts < 50) { // Don't run forever
    masonryLayout();
  }
}, 5000);
</script>
